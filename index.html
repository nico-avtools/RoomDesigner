<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Line Array Designer - V3</title>
<style>
/* Basic styling for the page and controls */
body {
font-family: Arial, sans-serif;
margin: 20px;
}
.controls {
margin-bottom: 10px;
}
.splay-control {
display: inline-block;
margin-right: 10px;
}
svg {
border: 1px solid #ccc;
background-color: #f8f8f8;
}
</style>
</head>
<body>
<h1>Line Array Designer - V3</h1>

<!-- Checkbox to toggle the addition of a LineArray -->
<div class="controls">
<label>
<input type="checkbox" id="addLineArray" />
Add LineArray
</label>
</div>

<!-- Input for Trim Height: vertical positioning of the line array -->
<div class="controls">
<label>
Trim Height (ft):
<input type="number" id="trimHeight" value="5" step="0.5" />
</label>
</div>

<!-- Input for Speaker Position: horizontal placement of the line array -->
<div class="controls">
<label>
Speaker Position (ft):
<input type="number" id="speakerPosition" value="2" step="0.5" />
</label>
</div>

<!-- Input for LineArray Size: number of speakers in the array -->
<div class="controls">
<label>
LineArray Size:
<input type="number" id="lineArraySize" value="1" min="1" max="6" step="1" />
</label>
</div>

<!-- Splay Angle Inputs A through E. They will be shown/hidden based on array size. -->
<div class="controls" id="splayAnglesContainer">
<div class="splay-control" id="splayControlA">
<label>
Splay A (°):
<input type="number" id="splayA" value="0" min="0" max="10" step="0.5" />
</label>
</div>
<div class="splay-control" id="splayControlB">
<label>
Splay B (°):
<input type="number" id="splayB" value="0" min="0" max="10" step="0.5" />
</label>
</div>
<div class="splay-control" id="splayControlC">
<label>
Splay C (°):
<input type="number" id="splayC" value="0" min="0" max="10" step="0.5" />
</label>
</div>
<div class="splay-control" id="splayControlD">
<label>
Splay D (°):
<input type="number" id="splayD" value="0" min="0" max="10" step="0.5" />
</label>
</div>
<div class="splay-control" id="splayControlE">
<label>
Splay E (°):
<input type="number" id="splayE" value="0" min="0" max="10" step="0.5" />
</label>
</div>
</div>

<!-- SVG area where the line array will be visualized -->
<svg id="diagram" width="600" height="800">
<!-- Group element to hold all speaker polygons in the line array -->
<g id="lineArrayGroup"></g>
</svg>

<script>
/**********************************************************************
* Line Array Designer V3 JavaScript
* 
* This script extends the previous version by adding splay angles between
* speaker boxes. Each splay angle tilts the boxes below it horizontally.
**********************************************************************/

// Constants for scaling and speaker dimensions in feet.
const scaleFeet = 10; // Scale: 1 foot equals 10 pixels.
const SPEAKER_WIDTH = 2; // Each speaker is 2 feet wide.
const LEFT_HEIGHT = 0.6; // Left side height of speaker in feet.
const RIGHT_HEIGHT = 1.0; // Right side height of speaker in feet.

// Get references to HTML elements.
const addLineArrayCheckbox = document.getElementById('addLineArray');
const trimHeightInput = document.getElementById('trimHeight');
const speakerPositionInput = document.getElementById('speakerPosition');
const lineArraySizeInput = document.getElementById('lineArraySize');
const svg = document.getElementById('diagram');
const lineArrayGroup = document.getElementById('lineArrayGroup');
const splayAnglesContainer = document.getElementById('splayAnglesContainer');

// Array of splay input elements for easy access.
const splayInputs = [
document.getElementById('splayA'),
document.getElementById('splayB'),
document.getElementById('splayC'),
document.getElementById('splayD'),
document.getElementById('splayE')
];

// Array of splay control containers to show/hide based on size.
const splayControls = [
document.getElementById('splayControlA'),
document.getElementById('splayControlB'),
document.getElementById('splayControlC'),
document.getElementById('splayControlD'),
document.getElementById('splayControlE')
];

/**
* updateSplayControls()
* 
* Shows or hides splay angle inputs based on the current line array size.
*/
function updateSplayControls(arraySize) {
// Number of splay angles needed = arraySize - 1.
const needed = Math.max(0, arraySize - 1);
for (let i = 0; i < splayControls.length; i++) {
// Show control if within needed range, otherwise hide.
splayControls[i].style.display = i < needed ? 'inline-block' : 'none';
}
}

/**
* updateDiagram()
* 
* Updates the SVG to display the line array of trapezoidal speaker shapes,
* taking into account splay angles between boxes.
*/
function updateDiagram() {
// Clear existing speaker shapes.
while (lineArrayGroup.firstChild) {
lineArrayGroup.removeChild(lineArrayGroup.firstChild);
}

// Only proceed if "Add LineArray" is checked.
if (!addLineArrayCheckbox.checked) return;

// Parse user input values.
let trimHeightFt = parseFloat(trimHeightInput.value) || 0;
let speakerPosFt = parseFloat(speakerPositionInput.value) || 0;
let arraySize = parseInt(lineArraySizeInput.value) || 1;

// Clamp array size between 1 and 6.
arraySize = Math.max(1, Math.min(arraySize, 6));

// Update which splay angle controls are visible based on array size.
updateSplayControls(arraySize);

// Read splay angle values for each connection up to arraySize-1.
let splayAngles = [];
for (let i = 0; i < arraySize - 1; i++) {
let angle = parseFloat(splayInputs[i].value) || 0;
// Convert angle to radians for calculation.
splayAngles.push(angle * Math.PI / 180);
}

// Calculate speaker dimensions in pixels.
const widthPx = SPEAKER_WIDTH * scaleFeet; // 2 ft wide in pixels.
const leftHeightPx = LEFT_HEIGHT * scaleFeet; // 0.6 ft tall on left side in pixels.
const rightHeightPx = RIGHT_HEIGHT * scaleFeet; // 1.0 ft tall on right side in pixels.

// Determine starting horizontal position.
const speakerPosPx = speakerPosFt * scaleFeet;
let currentX = speakerPosPx;

// Determine starting vertical position (for the top speaker).
let svgHeight = parseFloat(svg.getAttribute('height'));
let initialY = svgHeight - (trimHeightFt * scaleFeet) - rightHeightPx;
let currentY = initialY;

// Loop through each speaker in the array.
for (let i = 0; i < arraySize; i++) {
// Create a new SVG polygon for the speaker.
let polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');

// Define trapezoidal points for the current speaker.
let points = [
`${currentX},${currentY}`, // Top-left
`${currentX + widthPx},${currentY}`, // Top-right
`${currentX + widthPx},${currentY + rightHeightPx}`, // Bottom-right
`${currentX},${currentY + leftHeightPx}` // Bottom-left
].join(" ");

polygon.setAttribute('points', points);
polygon.setAttribute('fill', '#999');
polygon.setAttribute('stroke', '#000');

// Add the speaker shape to the SVG group.
lineArrayGroup.appendChild(polygon);

// If there is a next speaker, calculate its position based on the splay angle.
if (i < arraySize - 1) {
// Use the splay angle above the next speaker.
let angle = splayAngles[i] || 0;

// Calculate horizontal shift due to the splay angle.
// We assume the vertical spacing between speakers is rightHeightPx.
let horizShift = Math.tan(angle) * rightHeightPx;

// Update currentX by adding the horizontal shift.
currentX += horizShift;

// Move down vertically by the height of the current speaker on the right side.
currentY += rightHeightPx;
}
}
}

// Attach event listeners to update diagram on input changes.
const inputs = [
addLineArrayCheckbox,
trimHeightInput,
speakerPositionInput,
lineArraySizeInput,
...splayInputs
];
inputs.forEach(el => el.addEventListener('input', updateDiagram));

// Initial rendering of the diagram.
updateDiagram();
</script>
</body>
</html>
